"use strict";var shuffle=function(lista){var currentIndex=lista.length,temporaryValue,randomIndex;while(0!==currentIndex){randomIndex=Math.floor(Math.random()*currentIndex);currentIndex-=1;temporaryValue=lista[currentIndex];lista[currentIndex]=lista[randomIndex];lista[randomIndex]=temporaryValue}return lista};"use strict";var shadersSource={"vertex-shaper":["attribute vec4 a_position;","attribute vec4 a_color;","uniform mat4 u_matrix;","varying vec4 v_color;","void main() {","// Multiply the position by the matrix.","gl_Position = u_matrix * a_position;","// Pass the color to the fragment shader.","v_color = a_color;","}"].join("\n"),"fragment-shaper":["precision mediump float;","// Passed in from the vertex shader.","varying vec4 v_color;","void main() {","gl_FragColor = v_color;","}"].join("\n"),"vertex-text":["attribute vec4 a_position;","attribute vec2 a_texcoord;","uniform mat4 u_matrix;","varying vec2 v_texcoord;","void main() {","gl_Position = u_matrix * a_position;","v_texcoord = a_texcoord;","}"].join("\n"),"fragment-text":["precision mediump float;","varying vec2 v_texcoord;","uniform sampler2D u_texture;","uniform vec4 u_color;","void main() {","gl_FragColor = texture2D(u_texture, v_texcoord) * u_color;","}"].join("\n"),"vertex-texture":["attribute vec4 a_position;","attribute vec2 a_texcoord;","uniform mat4 u_matrix;","uniform mat4 u_textureMatrix;","varying vec2 v_texcoord;","void main() {","gl_Position = u_matrix * a_position;","v_texcoord = (u_textureMatrix * vec4(a_texcoord, 0, 1)).xy;","}"].join("\n"),"fragment-texture":["precision mediump float;","varying vec2 v_texcoord;","uniform sampler2D texture;","uniform vec4 u_color;","void main() {","if (v_texcoord.x < 0.0 ||","v_texcoord.y < 0.0 ||","v_texcoord.x > 1.0 ||","v_texcoord.y > 1.0) {","gl_FragColor = vec4(0, 0, 0, 0);","return;","}","gl_FragColor = texture2D(texture, v_texcoord) * u_color;","gl_FragColor.rgb *= gl_FragColor.a;","}"].join("\n")},createShader=function(gl,type,source){var shader=gl.createShader(type);gl.shaderSource(shader,source);gl.compileShader(shader);var success=gl.getShaderParameter(shader,gl.COMPILE_STATUS);if(success){return shader}console.log(gl.getShaderInfoLog(shader));gl.deleteShader(shader)},createProgram=function(gl,vertexShader,fragmentShader){var program=gl.createProgram();gl.attachShader(program,vertexShader);gl.attachShader(program,fragmentShader);gl.linkProgram(program);var success=gl.getProgramParameter(program,gl.LINK_STATUS);if(success){return program}console.log(gl.getProgramInfoLog(program));gl.deleteProgram(program)},createProgramFrom=function(gl,vertexSourceName,fragmentSourceName){var vertexSource=shadersSource[vertexSourceName],fragmentSource=shadersSource[fragmentSourceName];if(!vertexSource){throw new Error(vertexSourceName+" invalid ShadersSource")}if(!fragmentSourceName){throw new Error(fragmentSourceName+" invalid ShadersSource")}var vertexShader=createShader(gl,gl.VERTEX_SHADER,vertexSource),fragmentShader=createShader(gl,gl.FRAGMENT_SHADER,fragmentSource);return createProgram(gl,vertexShader,fragmentShader)},setCanvasSize=function(canvas,width,height){canvas.width=width;canvas.style.width=width+"px";canvas.height=height;canvas.style.height=height+"px"},degreesToRadians=function(angleInDegrees){return angleInDegrees*Math.PI/180},setLoop=function(callback){function loop(timestamp){var delta=timestamp-lastRender;callback(delta,timestamp,lastRender);lastRender=timestamp;window.requestAnimationFrame(loop)}var lastRender=0;window.requestAnimationFrame(loop)},hexToRgbArray=function(hex){var c;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)){c=hex.substring(1).split("");if(c.length===3){c=[c[0],c[0],c[1],c[1],c[2],c[2]]}c="0x"+c.join("");return[c>>16&255,c>>8&255,c&255]}console.error(hex);throw new Error("Bad Hex")};var m4={identity:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},translation:function(tx,ty,tz){return[1,0,0,0,0,1,0,0,0,0,1,0,tx,ty,tz,1]},xRotation:function(angleInRadians){var c=Math.cos(angleInRadians);var s=Math.sin(angleInRadians);return[1,0,0,0,0,c,s,0,0,-s,c,0,0,0,0,1]},yRotation:function(angleInRadians){var c=Math.cos(angleInRadians);var s=Math.sin(angleInRadians);return[c,0,-s,0,0,1,0,0,s,0,c,0,0,0,0,1]},zRotation:function(angleInRadians){var c=Math.cos(angleInRadians);var s=Math.sin(angleInRadians);return[c,s,0,0,-s,c,0,0,0,0,1,0,0,0,0,1]},scaling:function(sx,sy,sz){return[sx,0,0,0,0,sy,0,0,0,0,sz,0,0,0,0,1]},translate:function(m,tx,ty,tz){return m4.multiply(m,m4.translation(tx,ty,tz))},xRotate:function(m,angleInRadians){return m4.multiply(m,m4.xRotation(angleInRadians))},yRotate:function(m,angleInRadians){return m4.multiply(m,m4.yRotation(angleInRadians))},zRotate:function(m,angleInRadians){return m4.multiply(m,m4.zRotation(angleInRadians))},scale:function(m,sx,sy,sz){return m4.multiply(m,m4.scaling(sx,sy,sz))},multiply:function(a,b){var b00=b[0*4+0];var b01=b[0*4+1];var b02=b[0*4+2];var b03=b[0*4+3];var b10=b[1*4+0];var b11=b[1*4+1];var b12=b[1*4+2];var b13=b[1*4+3];var b20=b[2*4+0];var b21=b[2*4+1];var b22=b[2*4+2];var b23=b[2*4+3];var b30=b[3*4+0];var b31=b[3*4+1];var b32=b[3*4+2];var b33=b[3*4+3];var a00=a[0*4+0];var a01=a[0*4+1];var a02=a[0*4+2];var a03=a[0*4+3];var a10=a[1*4+0];var a11=a[1*4+1];var a12=a[1*4+2];var a13=a[1*4+3];var a20=a[2*4+0];var a21=a[2*4+1];var a22=a[2*4+2];var a23=a[2*4+3];var a30=a[3*4+0];var a31=a[3*4+1];var a32=a[3*4+2];var a33=a[3*4+3];return[b00*a00+b01*a10+b02*a20+b03*a30,b00*a01+b01*a11+b02*a21+b03*a31,b00*a02+b01*a12+b02*a22+b03*a32,b00*a03+b01*a13+b02*a23+b03*a33,b10*a00+b11*a10+b12*a20+b13*a30,b10*a01+b11*a11+b12*a21+b13*a31,b10*a02+b11*a12+b12*a22+b13*a32,b10*a03+b11*a13+b12*a23+b13*a33,b20*a00+b21*a10+b22*a20+b23*a30,b20*a01+b21*a11+b22*a21+b23*a31,b20*a02+b21*a12+b22*a22+b23*a32,b20*a03+b21*a13+b22*a23+b23*a33,b30*a00+b31*a10+b32*a20+b33*a30,b30*a01+b31*a11+b32*a21+b33*a31,b30*a02+b31*a12+b32*a22+b33*a32,b30*a03+b31*a13+b32*a23+b33*a33]},projection:function(width,height,depth){return[2/width,0,0,0,0,-2/height,0,0,0,0,2/depth,0,-1,1,0,1]},orthographic:function(left,right,bottom,top,near,far){return[2/(right-left),0,0,0,0,2/(top-bottom),0,0,0,0,2/(near-far),0,(left+right)/(left-right),(bottom+top)/(bottom-top),(near+far)/(near-far),1]}};function MatrixStack(){this.stack=[];this.restore()}MatrixStack.prototype.restore=function(){this.stack.pop();if(this.stack.length<1){this.stack[0]=m4.identity()}};MatrixStack.prototype.save=function(){this.stack.push(this.getCurrentMatrix())};MatrixStack.prototype.getCurrentMatrix=function(){return this.stack[this.stack.length-1].slice()};MatrixStack.prototype.setCurrentMatrix=function(m){this.stack[this.stack.length-1]=m;return m};MatrixStack.prototype.translate=function(x,y,z){if(z===undefined){z=0}var m=this.getCurrentMatrix();this.setCurrentMatrix(m4.translate(m,x,y,z))};MatrixStack.prototype.rotate=function(angleInRadians){var m=this.getCurrentMatrix();this.setCurrentMatrix(m4.zRotate(m,angleInRadians))};MatrixStack.prototype.scale=function(x,y,z){if(z===undefined){z=1}var m=this.getCurrentMatrix();this.setCurrentMatrix(m4.scale(m,x,y,z))};var textCtx=document.createElement("canvas").getContext("2d");function makeTextCanvas(text,width,height,maxWidth){textCtx.canvas.width=width;textCtx.canvas.height=height;textCtx.font="20px monospace";textCtx.textAlign="center";textCtx.textBaseline="middle";textCtx.fillStyle="white";textCtx.clearRect(0,0,textCtx.canvas.width,textCtx.canvas.height);text.split("\n").forEach(function(line,key){textCtx.fillText(line,width/2,height/2+key*20,maxWidth||width)});return textCtx.canvas}var loadImageAndCreateTextureInfo=null,gl=null,canvas={},textureProgram=null,tPosition=null,tTexcoord=null,tMatrix=null,tTextureMatrix=null,tTexture=null,shaperProgram=null,sPosition=null,sColor=null,sMatrix=null,sVColor=null,sPositionBuffer=null,sColorBuffer=null,positionBuffer=null,positions=null,sPositions=null,sColors=null,trianglesPoints=null,texcoordBuffer=null,texcoords=null,drawImage=null,drawShape=null,matrixStack=null,createTextTextureInfo=function(){},textProgram=null,drawText=null,tColor,ejetWebglInit=function(canvasQuerySelector){canvas=document.querySelector(canvasQuerySelector);gl=canvas.getContext("webgl");if(!gl){return}matrixStack=new MatrixStack;textureProgram=createProgramFrom(gl,"vertex-texture","fragment-texture");tPosition=gl.getAttribLocation(textureProgram,"a_position");tTexcoord=gl.getAttribLocation(textureProgram,"a_texcoord");tMatrix=gl.getUniformLocation(textureProgram,"u_matrix");tTextureMatrix=gl.getUniformLocation(textureProgram,"u_textureMatrix");tTexture=gl.getUniformLocation(textureProgram,"u_texture");tColor=gl.getUniformLocation(textureProgram,"u_color");positionBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,positionBuffer);positions=[0,0,0,1,1,0,1,0,0,1,1,1];gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(positions),gl.STATIC_DRAW);texcoordBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,texcoordBuffer);texcoords=[0,0,0,1,1,0,1,0,0,1,1,1];gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(texcoords),gl.STATIC_DRAW);shaperProgram=createProgramFrom(gl,"vertex-shaper","fragment-shaper");sPosition=gl.getAttribLocation(shaperProgram,"a_position");sColor=gl.getAttribLocation(shaperProgram,"a_color");sMatrix=gl.getUniformLocation(shaperProgram,"u_matrix");sPositionBuffer=gl.createBuffer();sColorBuffer=gl.createBuffer();createTextTextureInfo=function(name,width,height,pixelart){var textCanvas=makeTextCanvas(name,width,height),textWidth=textCanvas.width,textHeight=textCanvas.height,textTex=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,textTex);gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);if(pixelart){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST)}gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,textCanvas);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);return{texture:textTex,width:textWidth,height:textHeight}};loadImageAndCreateTextureInfo=function(url,pixelart){pixelart=pixelart||true;var tex=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,tex);gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);if(pixelart){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST)}gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]));gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);var textureInfo={width:1,height:1,texture:tex};var img=new Image;img.addEventListener("load",function(){textureInfo.width=img.width;textureInfo.height=img.height;gl.bindTexture(gl.TEXTURE_2D,textureInfo.texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,img)});img.src=url;return textureInfo};drawImage=function(tex,texWidth,texHeight,srcX,srcY,srcWidth,srcHeight,dstX,dstY,dstWidth,dstHeight){if(dstX===undefined){dstX=srcX}if(dstY===undefined){dstY=srcY}if(srcWidth===undefined){srcWidth=texWidth}if(srcHeight===undefined){srcHeight=texHeight}if(dstWidth===undefined){dstWidth=srcWidth}if(dstHeight===undefined){dstHeight=srcHeight}gl.bindTexture(gl.TEXTURE_2D,tex);gl.enable(gl.BLEND);gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);gl.useProgram(textureProgram);gl.bindBuffer(gl.ARRAY_BUFFER,positionBuffer);gl.enableVertexAttribArray(tPosition);gl.vertexAttribPointer(tPosition,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,texcoordBuffer);gl.enableVertexAttribArray(tTexcoord);gl.vertexAttribPointer(tTexcoord,2,gl.FLOAT,false,0,0);var matrix=m4.orthographic(0,gl.canvas.width,gl.canvas.height,0,-1,1);matrix=m4.multiply(matrix,matrixStack.getCurrentMatrix());matrix=m4.translate(matrix,dstX,dstY,-1);matrix=m4.scale(matrix,dstWidth,dstHeight,1);gl.uniformMatrix4fv(tMatrix,false,matrix);var texMatrix=m4.translation(srcX/texWidth,srcY/texHeight,0);texMatrix=m4.scale(texMatrix,srcWidth/texWidth,srcHeight/texHeight,1);gl.uniformMatrix4fv(tTextureMatrix,false,texMatrix);gl.uniform4fv(tColor,[1,1,1,1]);gl.uniform1i(tTexture,0);gl.drawArrays(gl.TRIANGLES,0,6)};drawShape={triangle:function(x,y,width,height,rotation,color){var count=3,colorArray=[],i=0;gl.useProgram(shaperProgram);gl.enableVertexAttribArray(sPosition);gl.bindBuffer(gl.ARRAY_BUFFER,sPositionBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,1,0,1,1,0,.5,0,0]),gl.STATIC_DRAW);gl.vertexAttribPointer(sPosition,3,gl.FLOAT,false,0,0);gl.enableVertexAttribArray(sColor);gl.bindBuffer(gl.ARRAY_BUFFER,sColorBuffer);while(i<count){colorArray=colorArray.concat(hexToRgbArray(color));i+=1}gl.bufferData(gl.ARRAY_BUFFER,new Uint8Array(colorArray),gl.STATIC_DRAW);gl.vertexAttribPointer(sColor,3,gl.UNSIGNED_BYTE,true,0,0);var matrix=m4.orthographic(0,gl.canvas.width,gl.canvas.height,0,-1,1);matrix=m4.zRotate(matrix,rotation);matrix=m4.translate(matrix,x,y,0);matrix=m4.scale(matrix,width,height,1);gl.uniformMatrix4fv(sMatrix,false,matrix);gl.drawArrays(gl.TRIANGLES,0,count)},square:function(x,y,width,height,rotation,color){var count=6,colorArray=[],i=0;gl.useProgram(shaperProgram);gl.enableVertexAttribArray(sPosition);gl.bindBuffer(gl.ARRAY_BUFFER,sPositionBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,1,0]),gl.STATIC_DRAW);gl.vertexAttribPointer(sPosition,3,gl.FLOAT,false,0,0);gl.enableVertexAttribArray(sColor);gl.bindBuffer(gl.ARRAY_BUFFER,sColorBuffer);while(i<count){colorArray=colorArray.concat(hexToRgbArray(color));i+=1}gl.bufferData(gl.ARRAY_BUFFER,new Uint8Array(colorArray),gl.STATIC_DRAW);gl.vertexAttribPointer(sColor,3,gl.UNSIGNED_BYTE,true,0,0);var matrix=m4.orthographic(0,gl.canvas.width,gl.canvas.height,0,-1,1);matrix=m4.zRotate(matrix,rotation);matrix=m4.translate(matrix,x,y,0);matrix=m4.scale(matrix,width,height,1);gl.uniformMatrix4fv(sMatrix,false,matrix);gl.drawArrays(gl.TRIANGLES,0,count)}};drawText=function(textTexture,x,y,textColor){textColor=textColor||[0,0,0,1];gl.bindTexture(gl.TEXTURE_2D,textTexture.texture);gl.enable(gl.BLEND);gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);gl.useProgram(textureProgram);gl.bindBuffer(gl.ARRAY_BUFFER,positionBuffer);gl.enableVertexAttribArray(tPosition);gl.vertexAttribPointer(tPosition,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,texcoordBuffer);gl.enableVertexAttribArray(tTexcoord);gl.vertexAttribPointer(tTexcoord,2,gl.FLOAT,false,0,0);var matrix=m4.orthographic(0,gl.canvas.width,gl.canvas.height,0,-1,1);matrix=m4.multiply(matrix,matrixStack.getCurrentMatrix());matrix=m4.translate(matrix,x,y,-1);matrix=m4.scale(matrix,textTexture.width,textTexture.height,1);gl.uniformMatrix4fv(tMatrix,false,matrix);gl.uniformMatrix4fv(tTextureMatrix,false,m4.identity());gl.uniform4fv(tColor,textColor);gl.uniform1i(tTexture,0);gl.drawArrays(gl.TRIANGLES,0,6)}};"use strict";var MAX_ENTITYS=50;var Component={transform:function(x,y,scaleX,scaleY,rotation){return{null:true,type:"transform",x:x||0,y:y||0,scaleX:scaleX||1,scaleY:scaleY||1,rotation:rotation||0}},motion:function(speed,acceleration){return{null:true,type:"motion",speed:speed||[0,0],acceleration:acceleration||[0,0]}},sprite:function(textureInfo,width,height,sourceX,sourceY,x,y){if(x!==0){x=x||-width/2}if(y!==0){y=y||-height/2}return{null:true,type:"sprite",textureInfo:textureInfo||{},width:width||0,height:height||0,sourceX:sourceX||0,sourceY:sourceY||0,x:x,y:y,flipX:false,flipY:false}},shape:function(typeOfShape,width,height,color,offSetX,offSetY){if(offSetX!==0){offSetX=offSetX||-width/2}if(offSetY!==0){offSetY=offSetY||-height/2}return{null:true,type:"shape",typeOfShape:typeOfShape||"triangle",width:width||0,height:height||0,color:color||"#FF0000",offSetX:offSetX,offSetY:offSetY}},text:function(text,width,height,offSetX,offSetY,color,pixelart){text=text||"";var newLines=text.match(/\n/g)||[];if(offSetX!==0){offSetX=offSetX||-width/2}if(offSetY!==0){offSetY=offSetY||-height/2-newLines.length*10}return{null:true,type:"text",_text:text,textInfo:createTextTextureInfo(text,width,height,pixelart),offSetX:offSetX,offSetY:offSetY,color:color||[1,1,1,1],get text(){return this._text},set text(value){this._text=value;this.textInfo=createTextTextureInfo(value,width,height,pixelart)}}},spriteAnimation:function(sourceFrame,fps,loop,stop){sourceFrame=sourceFrame||[];return{null:true,type:"spriteAnimation",currFrame:0,interval:0,fps:1e3/(fps||4),frames:sourceFrame,length:sourceFrame.length,loop:loop||false,stop:stop||false}},textAnimation:function(finalText,fps,loop,stop){finalText=finalText||"";return{null:true,type:"textAnimation",currFrame:0,interval:0,fps:1e3/(fps||4),_finalText:finalText,get finalText(){return this._finalText},set finalText(value){this.currFrame=0;this.length=value.length+1;this._finalText=value},length:finalText.length+1,loop:loop||false,stop:stop||false}},hitBox:function(x,y,width,height){if(x!==0){x=x||-width/2}if(y!==0){y=y||-height/2}return{null:true,type:"hitBox",x:x||0,y:y||0,xAbsolute:x+canvas.clientLeft+canvas.offsetLeft,yAbsolute:y+canvas.clientTop+canvas.offsetTop,width:width||0,height:height||0}}};var Holder={};Object.keys(Component).forEach(function(name){Holder[name]=new Array(MAX_ENTITYS-1).fill(Component[name]())});var EntityCounter=0,Entity=function(){var nEntity={id:EntityCounter,children:[]};nEntity.add=function(component){try{var type=component.type;component.null=false;Holder[type][nEntity.id]=component;return nEntity}catch(error){console.log("componentType: "+component.type);throw new Error(error)}};nEntity.get=function(componentType){try{var component=Holder[componentType][nEntity.id];if(!component.null){return component}return null}catch(error){console.log("componentType: "+componentType);throw new Error(error)}};nEntity.set=function(component){Holder[component.type][nEntity.id]=component};nEntity.remove=function(componentType){Holder[componentType][nEntity.id].null=true;return nEntity};EntityCounter+=1;if(EntityCounter>MAX_ENTITYS){throw Error("Too many Entity! (Increase the MAX_ENTITYS number)")}return nEntity};var System={renderSprite:function(entity){var transform=entity.get("transform"),sprite=entity.get("sprite");if(!transform||!sprite){return}var textureInfo=sprite.textureInfo,scaleX=transform.scaleX,scaleY=transform.scaleY;if(sprite.flipX){scaleX*=-1}if(sprite.flipY){scaleY*=-1}matrixStack.save();matrixStack.translate(transform.x,transform.y);matrixStack.scale(scaleX,scaleY);drawImage(textureInfo.texture,textureInfo.width,textureInfo.height,sprite.sourceX,sprite.sourceY,sprite.width,sprite.height,sprite.x,sprite.y);matrixStack.restore()},renderShape:function(entity){var transform=entity.get("transform"),shape=entity.get("shape");if(!transform||!shape){return}matrixStack.save();matrixStack.translate(transform.x,transform.y);matrixStack.scale(transform.scaleX,transform.scaleY);drawShape[shape.typeOfShape](transform.x+shape.offSetX,transform.y+shape.offSetY,shape.width,shape.height,transform.rotation,shape.color);matrixStack.restore()},renderText:function(entity){var transform=entity.get("transform"),text=entity.get("text");if(!transform||!text){return}matrixStack.save();matrixStack.translate(transform.x,transform.y);matrixStack.scale(transform.scaleX,transform.scaleY);drawText(text.textInfo,text.offSetX,text.offSetY,text.color);matrixStack.restore()},movement:function(entity,delta,parentMotion){var transform=entity.get("transform"),motion=parentMotion||entity.get("motion"),children=entity.children;if(!transform||!motion){return}delta=delta||1;var speed=motion.speed,acceleration=motion.acceleration;transform.x+=speed[0]*delta;transform.y+=speed[1]*delta;speed[0]+=acceleration[0]*delta;speed[1]+=acceleration[1]*delta;if(children.length===0){return}children.forEach(function(child){System.movement(child,delta,motion)})},animateSprite:function(entity,delta){var sprite=entity.get("sprite"),animation=entity.get("spriteAnimation");if(!sprite||!animation||animation.stop){return}var interval=animation.interval,currFrame=animation.currFrame,len=animation.length;interval+=delta;if(interval>=animation.fps){currFrame=(currFrame+1)%len;interval=0;var frame=animation.frames[currFrame];sprite.sourceX=frame.x;sprite.sourceY=frame.y}if(!animation.loop&&currFrame===len-1){animation.stop=true;currFrame=0}animation.interval=interval;animation.currFrame=currFrame},animateText:function(entity,delta){var text=entity.get("text"),animation=entity.get("textAnimation");if(!text||!animation||animation.stop){return}var interval=animation.interval,currFrame=animation.currFrame,len=animation.length;interval+=delta;if(interval>=animation.fps){currFrame=(currFrame+1)%len;interval=0;text.text=animation.finalText.slice(0,currFrame)}if(!animation.loop&&currFrame===len-1){animation.stop=true;currFrame=0}animation.interval=interval;animation.currFrame=currFrame}};"use strict";var ejetInput=null,ejetInputInit=function(){var realState={keyStates:new Array(256),gamepadStates:new Array(16),mouseStates:new Array(3),mousePosition:{x:0,y:0}};var that=function(){};that.keyStates=new Array(256);that.previousKeyStates=new Array(256);that.gamepadStates=new Array(16);that.previousGamepadStates=new Array(16);that.mouseStates=new Array(3);that.previousMouseStates=new Array(3);that.useRealState=false;that.mousePosition={x:0,y:0};that.lastMousePosition={x:0,y:0};for(var i=0;i<that.keyStates.length;i++){that.keyStates[i]=false;that.previousKeyStates[i]=false}for(var i=0;i<that.gamepadStates.length;i++){that.gamepadStates[i]=false;that.previousGamepadStates[i]=false}for(var i=0;i<that.mouseStates.length;i++){that.mouseStates[i]=false;that.previousMouseStates[i]=false}var isFireFox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;var removeWhiteSpace=function(string){var input=input+"";return string.replace(/\s+/,"")};var stripWhiteSpace=function(string){var input=input+"";return string.replace(/\s+/," ")};var convertStringToKeycode=function(key){var key=removeWhiteSpace(key);key=key.toUpperCase();switch(key){case"BACKSPACE":return["key",8];case"SPACEBAR":return["key",32];case"SPACE":return["key",32];case"TAB":return["key",9];case"ENTER":return["key",13];case"SHIFT":return["key",16];case"CONTROL":return["key",17];case"CTRL":return["key",17];case"ALT":return["key",18];case"CAPSLOCK":return["key",20];case"ESCAPE":return["key",27];case"ESC":return["key",27];case"PAGEUP":return["key",33];case"PAGEDOWN":return["key",34];case"ARROWLEFT":return["key",37];case"ARROWUP":return["key",38];case"ARROWRIGHT":return["key",38];case"ARROWDOWN":return["key",40];case"INSERT":return["key",45];case"DELETE":return["key",46];case"+":return["key",isFireFox?61:187];case"=":return["key",isFireFox?61:187];case"-":return["key",isFireFox?173:189];case"[":return["key",219];case"]":return["key",221];case"/":return["key",191];case"\\":return["key",220];default:return["key",key.charCodeAt(0)]}};var convertStringToGamepadCode=function(button){var button=removeWhiteSpace(button);button=button.toUpperCase();switch(button){case"TRIANGLE":return["gamepad",0];case"CIRCLE":return["gamepad",1];case"AXE":return["gamepad",2];case"SQUARE":return["gamepad",3];case"L1":return["gamepad",4];case"R1":return["gamepad",5];case"R2":return["gamepad",6];case"L2":return["gamepad",7];case"RESET":return["gamepad",8];case"START":return["gamepad",9];case"L3":return["gamepad",10];case"R3":return["gamepad",11];case"BUTTONUP":return["gamepad",12];case"BUTTONRIGHT":return["gamepad",13];case"BUTTONDOWN":return["gamepad",14];case"BUTTONLEFT":return["gamepad",15];default:return null}};var convertStringToKeyCombo=function(keyCombo){var keyComboString=stripWhiteSpace(keyCombo);var combo=keyComboString.split(" ");for(var i=0;i<combo.length;i++){combo[i]=convertStringToKeycode(combo[i])}return combo};var convertStringToButtonCode=function(buttonCode){var code=removeWhiteSpace(buttonCode);code=code.toUpperCase();switch(code){case"MOUSELEFT":return["mouse",0];case"MOUSEMIDDLE":return["mouse",1];case"MOUSERIGHT":return["mouse",2];default:return null}};var convertStringToCombo=function(combo){var combo=stripWhiteSpace(combo);var tokens=combo.split(" ");var keysAndButtons=[];for(var i=0;i<tokens.length;i++){var code=convertStringToButtonCode(tokens[i]);if(code){keysAndButtons.push(code);continue}code=convertStringToGamepadCode(tokens[i]);if(code){keysAndButtons.push(code);continue}keysAndButtons.push(convertStringToKeycode(tokens[i]))}return keysAndButtons};var checkCombo=function(combination,mouseStates,keyStates,gamepadStates){var combo=convertStringToCombo(combination),inputType=null;for(var i=0;i<combo.length;i++){inputType=combo[0][i];if(inputType==="mouse"){if(!mouseStates[combo[i][1]]){return false}}else if(inputType==="gamepad"){if(!gamepadStates[combo[i][1]]){return false}}else{if(!keyStates[combo[i][1]]){return false}}}return true};var init=function(){for(var i=0;i<realState.keyStates.length;i++){realState.keyStates[i]=false}for(var i=0;i<realState.mouseStates.length;i++){realState.mouseStates[i]=false}};var isKeyDown=function(key,keyStateArray){var keyCode=convertStringToKeycode(key);return keyStazteArray[keyCode]};var isButtonDown=function(button,buttonStateArray){var buttonCode=convertStringToButtonCode(button);return buttonStateArray[buttonCode]};var isKeyClicked=function(key,currentKeyStateArray,previousKeyStateArray){return isKeyDown(key,currentKeyStateArray)&&!isKeyDown(key,previousKeyStateArray)};var isButtonClicked=function(key,currentButtonStateArray,previousButtonStateArray){return isButtonDown(key,currentButtonStateArray)&&!isButtonDown(key,previousButtonStateArray)};that.prototype.isReleased=function(combo){return!checkCombo(combo,that.mouseStates,that.keyStates,that.gamepadStates)&&checkCombo(combo,that.previousMouseStates,that.previousKeyStates,that.previousGamepadStates)};that.prototype.isPressed=function(combo){return checkCombo(combo,that.mouseStates,that.keyStates,that.gamepadStates)&&!checkCombo(combo,that.previousMouseStates,that.previousKeyStates,that.gamepadStates)};that.prototype.isDown=function(combo){if(that.useRealState){that.mousePosition.x=realState.mousePosition.x;that.mousePosition.y=realState.mousePosition.y;return checkCombo(combo,realState.mouseStates,realState.keyStates,realState.gamepadStates)}return checkCombo(combo,that.mouseStates,that.keyStates,that.gamepadStates)};that.prototype.update=function(){that.previousKeyStates=that.keyStates.slice(0);that.keyStates=realState.keyStates.slice(0);var gamepadStates=that.gamepadStates;that.previousGamepadStates=gamepadStates.slice(0);var gamepads=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];if(gamepads[0]){var buttons=gamepads[0].buttons;if(buttons){buttons.forEach((button,key)=>{gamepadStates[key]=false;if(button.pressed){gamepadStates[key]=true}})}}that.gamepadStates=gamepadStates;that.previousMouseStates=that.mouseStates.slice(0);that.mouseStates=realState.mouseStates.slice(0);that.lastMousePosition.x=that.mousePosition.x;that.lastMousePosition.y=that.mousePosition.y;that.mousePosition.x=realState.mousePosition.x;that.mousePosition.y=realState.mousePosition.y};window.onkeydown=function(e){if(e.which==18)e.preventDefault();realState.keyStates[e.which]=true};window.onkeyup=function(e){realState.keyStates[e.which]=false};canvas.onmousedown=function(e){realState.mouseStates[e.button]=true};window.onmouseup=function(e){realState.mouseStates[e.button]=false};canvas.onmousemove=function(e){realState.mousePosition.x=e.offsetX;realState.mousePosition.y=e.offsetY};that.prototype.onMouseOver=function(entity,action){var hitBox=entity.get("hitBox");var transform=entity.get("transform");if(!hitBox||!transform){return}var x=hitBox.xAbsolute+transform.x,y=hitBox.yAbsolute+transform.y,mouseX=realState.mousePosition.x,mouseY=realState.mousePosition.y;if(mouseX>x&&mouseX<hitBox.width+x&&mouseY>y&&mouseY<hitBox.height+y){action()}};that.prototype.onClick=function(entity,action){if(!that.mouseStates[0]){return}var hitBox=entity.get("hitBox"),transform=entity.get("transform");if(!hitBox||!transform){return}var x=hitBox.xAbsolute+transform.x,y=hitBox.yAbsolute+transform.y,mouseX=realState.mousePosition.x,mouseY=realState.mousePosition.y;if(mouseX>x&&mouseX<hitBox.width+x&&mouseY>y&&mouseY<hitBox.height+y){action()}};init();ejetInput=new that};"use strict";var createElement=function(type){var el=document.createElement(type);el.setClassName=function(className){el.className=className;return el};el.setInnerHTML=function(innerHTML){el.innerHTML=innerHTML;return el};el.adicionarNoFinal=function(parent){parent.appendChild(el);return el};el.adicionarNoInicio=function(parent){var fc=parent.firstChild;if(fc){parent.insertBefore(el,fc)}else{parent.appendChild(el)}return el};return el};var criarModalQuestao=function(title,description){var documentBody=document.body;var modal={},container=createElement("div").setClassName("ejet-modal").adicionarNoInicio(documentBody),body=createElement("div").setClassName("ejet-modal-content").adicionarNoFinal(container),title=createElement("div").setClassName("ejet-title").setInnerHTML(title||""),buttonsDiv=createElement("div").setClassName("ejet-buttons-div").adicionarNoFinal(body),vButton=createElement("span").setClassName("ejet-button").setInnerHTML("✔").adicionarNoFinal(buttonsDiv),xButton=createElement("span").setClassName("ejet-button").setInnerHTML("✘").adicionarNoFinal(buttonsDiv),toggle=function(){container.classList.toggle("ejet-show-modal")},show=function(){container.classList.add("ejet-show-modal")},hide=function(){container.classList.remove("ejet-show-modal")};modal.container=container;modal.body=body;if(description){modal.description=createElement("textarea").setClassName("ejet-description").setInnerHTML(description).adicionarNoInicio(body);modal.description.readOnly=true}modal.title=title.adicionarNoInicio(body);modal.buttonsDiv=buttonsDiv;modal.toggle=toggle;modal.show=show;modal.hide=hide;modal.v=toggle;modal.x=hide;vButton.addEventListener("click",modal.v);xButton.addEventListener("click",modal.x);modal.setV=function(acao){vButton.removeEventListener("click",modal.v);modal.v=acao;vButton.addEventListener("click",acao);return modal};modal.setX=function(acao){xButton.removeEventListener("click",modal.x);modal.x=acao;xButton.addEventListener("click",acao);return modal};return modal};"use strict";var ejetJogoDaMemoria=function(conteiner,dados,final){ejetWebglInit(conteiner);ejetInputInit();var scaleScreen=2,screenw=480,screenh=270,canvasw=screenw*scaleScreen,canvash=screenh*scaleScreen;setCanvasSize(canvas,canvasw,canvash);gl.viewport(0,0,canvasw,canvash);var subjects=Object.keys(dados),descriptions=shuffle(Object.values(dados)),modal=criarModalQuestao("Esta descrição condizer como o assunto?","..."),createSubject=function(x,y,text,color){return(new Entity).add(Component.transform(x,y)).add(Component.shape("square",150,150,color)).add(Component.text(text,150,150,null,null,[0,0,0,1])).add(Component.textAnimation(text,5)).add(Component.hitBox(-150/2,-150/2,150,150))},createOptions=function(x,y,listOfStrings,backgroundColor,color){var subjectOptions=(new Entity).add(Component.transform(x,y)).add(Component.motion()),background=(new Entity).add(Component.transform(x,y)).add(Component.shape("square",canvasw,canvash,backgroundColor,0,0));var gap=175,i=0,string="",subject=null,options=[],_color=color,_answered=false;while(i<10){if(i<listOfStrings.length){string=listOfStrings[i];_color=color;_answered=false}else{string="...";_color=["#936A63","#A88B75"];_answered=true}subject=createSubject(gap*(i%5-2),i<5?250:425,string,_color[i%2]);subject.get("transform").x+=canvasw/2+x;subject.get("transform").y+=10+y;subject.index=i;subject.answered=_answered;options.push(subject);i+=1}subjectOptions.children=[background].concat(options);return subjectOptions},title=(new Entity).add(Component.transform(canvasw/2,90)).add(Component.shape("square",700,150,"#655057")).add(Component.text("",700,150,null,null,[1,1,1,1])).add(Component.textAnimation("Escolha um assunto",5)),subjectOptions=createOptions(0,0,subjects,"#f0cf8e",["#cb8175","#e2a97e"]),descriptionOptions=createOptions(canvasw,0,new Array(subjects.length).fill("?"),"#f6edcd",["#a8c8a6","#6d8d8a"]),container=(new Entity).add(Component.transform()).add(Component.motion());container.children=[subjectOptions,descriptionOptions];var errors={};subjects.forEach(function(subject){errors[subject]=0});var answereds=0,selectedSubject=null,selectedDescription=null,titleText=title.get("textAnimation"),containerMotion=container.get("motion"),containerTransform=container.get("transform"),moving=false,updateOption=function(options,delta,onClick){options.children.forEach(function(subject){System.animateText(subject,delta);ejetInput.onClick(subject,function(){if(moving){return}onClick(subject)});System.renderShape(subject);System.renderText(subject)});if(containerTransform.x<=-canvasw&&moving){containerMotion.speed=[0,0];moving=false}else if(containerTransform.x>=0&&moving){containerMotion.speed=[0,0];moving=false}};var slide=function(direction){containerMotion.speed[0]=direction*canvasw/30;containerTransform.x+=direction;moving=true};modal.setV(function(){modal.toggle();var subject=titleText.finalText;if(dados[subject]===modal.description.innerHTML){var white=[1,1,1,1],selectedSubjectText=selectedSubject.get("text");selectedSubjectText.color=white;selectedDescription.get("text").text=selectedSubjectText.text;selectedSubject.answered=true;answereds+=1;if(answereds===subjects.length){final(errors)}}else{errors[subject]+=1}slide(1)});var update=function(delta){System.animateText(title,delta);System.movement(container);updateOption(subjectOptions,delta,function(subject){if(subject.answered){return}titleText.finalText=subject.get("textAnimation").finalText;titleText.stop=false;selectedSubject=subject;slide(-1)});updateOption(descriptionOptions,delta,function(description){if(description.answered){return}selectedDescription=description;modal.description.setInnerHTML(descriptions[description.index]);modal.show()});System.renderShape(title);System.renderText(title)};gl.clearColor(0,0,0,1);setLoop(function(delta){setCanvasSize(canvas,canvasw,canvash);gl.viewport(0,0,canvasw,canvash);gl.clear(gl.COLOR_BUFFER_BIT);ejetInput.update();update(delta)})};
